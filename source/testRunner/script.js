"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.runTest = runTest;exports.subprocessInspector = subprocessInspector;var _path = _interopRequireDefault(require("path"));
var _assert = _interopRequireDefault(require("assert"));
var _listFileRecursively = require("./utility/listFileRecursively.js");

var _nodejsLiveReload = require("@dependency/nodejsLiveReload");
var _fs = require("fs");
var _child_process = _interopRequireDefault(require("child_process"));const mochaModule = _path.default.join(__dirname, '../../entrypoint/cli/index.js');

async function runTest({
  targetProject,
  testPath,
  jsFileExtension = ['.js', '.ts'],
  testFileExtension = ['.test.js'] } =
{}) {
  console.log(`\x1b[33m\x1b[1m\x1b[7m\x1b[36m%s\x1b[0m \x1b[2m\x1b[3m%s\x1b[0m`, `Container:`, `NodeJS App`);


  await require('@dependency/addModuleResolutionPath').addModuleResolutionPath({ pathArray: [_path.default.dirname(require.main.filename)] });

  process.on('SIGINT', () => {
    console.log('Caught interrupt signal - test container level');
    process.exit(0);
  });

  (0, _assert.default)(targetProject, `targetProject must be passed.`);
  let targetProjectRootPath = targetProject.configuration.rootPath;

  if (!_path.default.isAbsolute(testPath)) {
    testPath = _path.default.join(targetProjectRootPath, testPath);
  }
  let jsPathArray = [targetProjectRootPath];
  if (await _fs.promises.lstat(testPath).then(statObject => statObject.isDirectory())) jsPathArray.push(testPath);


  console.log(`â€¢ Searching for ${JSON.stringify(testFileExtension)} extension files, in path ${testPath}.`);
  let testFileArray;
  if (testFileExtension.some(extension => testPath.endsWith(extension))) {

    console.log(testPath);
    testFileArray = [testPath];
  } else {

    testFileArray = (0, _listFileRecursively.listFileWithExtension)({ directory: testPath, extension: testFileExtension });
  }

  let jsFileArrayOfArray = jsPathArray.map(jsPath => {
    return (0, _listFileRecursively.listFileWithExtension)({ directory: jsPath, extension: jsFileExtension });
  });


  let watchFileArray = Array.prototype.concat.apply([], jsFileArrayOfArray);

  let stringifyArgs = JSON.stringify([{ testTarget: testFileArray, jsFileArray: jsFileArrayOfArray }]);
  let subprocess;
  function runMochaInSubprocess() {

    subprocess = _child_process.default.fork(mochaModule, [stringifyArgs], { stdio: [0, 1, 2, 'ipc'] });

  }
  let triggerCallback = () => {

    subprocess && subprocess.kill('SIGINT');
    runMochaInSubprocess();
  };

  await (0, _nodejsLiveReload.watchFile)({ triggerCallback, fileArray: Array.prototype.concat.apply([], [watchFileArray, testFileArray]), ignoreNodeModules: true, logMessage: false });

  runMochaInSubprocess();
}









function subprocessInspector({ port = 9229, host = 'localhost', shouldbreak = true } = {}) {
  const inspector = require('inspector');
  inspector.open(port, host, shouldbreak);

  process.on('beforeExit', () => {
    setTimeout(() => {}, 1000000000);
  });
  return inspector;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NvdXJjZS90ZXN0UnVubmVyL3NjcmlwdC5qcyJdLCJuYW1lcyI6WyJtb2NoYU1vZHVsZSIsInBhdGgiLCJqb2luIiwiX19kaXJuYW1lIiwicnVuVGVzdCIsInRhcmdldFByb2plY3QiLCJ0ZXN0UGF0aCIsImpzRmlsZUV4dGVuc2lvbiIsInRlc3RGaWxlRXh0ZW5zaW9uIiwiY29uc29sZSIsImxvZyIsInJlcXVpcmUiLCJhZGRNb2R1bGVSZXNvbHV0aW9uUGF0aCIsInBhdGhBcnJheSIsImRpcm5hbWUiLCJtYWluIiwiZmlsZW5hbWUiLCJwcm9jZXNzIiwib24iLCJleGl0IiwidGFyZ2V0UHJvamVjdFJvb3RQYXRoIiwiY29uZmlndXJhdGlvbiIsInJvb3RQYXRoIiwiaXNBYnNvbHV0ZSIsImpzUGF0aEFycmF5IiwiZmlsZXN5c3RlbSIsImxzdGF0IiwidGhlbiIsInN0YXRPYmplY3QiLCJpc0RpcmVjdG9yeSIsInB1c2giLCJKU09OIiwic3RyaW5naWZ5IiwidGVzdEZpbGVBcnJheSIsInNvbWUiLCJleHRlbnNpb24iLCJlbmRzV2l0aCIsImRpcmVjdG9yeSIsImpzRmlsZUFycmF5T2ZBcnJheSIsIm1hcCIsImpzUGF0aCIsIndhdGNoRmlsZUFycmF5IiwiQXJyYXkiLCJwcm90b3R5cGUiLCJjb25jYXQiLCJhcHBseSIsInN0cmluZ2lmeUFyZ3MiLCJ0ZXN0VGFyZ2V0IiwianNGaWxlQXJyYXkiLCJzdWJwcm9jZXNzIiwicnVuTW9jaGFJblN1YnByb2Nlc3MiLCJjaGlsZFByb2Nlc3MiLCJmb3JrIiwic3RkaW8iLCJ0cmlnZ2VyQ2FsbGJhY2siLCJraWxsIiwiZmlsZUFycmF5IiwiaWdub3JlTm9kZU1vZHVsZXMiLCJsb2dNZXNzYWdlIiwic3VicHJvY2Vzc0luc3BlY3RvciIsInBvcnQiLCJob3N0Iiwic2hvdWxkYnJlYWsiLCJpbnNwZWN0b3IiLCJvcGVuIiwic2V0VGltZW91dCJdLCJtYXBwaW5ncyI6IjRPQUFBO0FBQ0E7QUFDQTs7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dCBhc3NlcnQgZnJvbSAnYXNzZXJ0J1xuaW1wb3J0IHsgbGlzdEZpbGVSZWN1cnNpdmVseSwgbGlzdEZpbGVXaXRoRXh0ZW5zaW9uIH0gZnJvbSAnLi91dGlsaXR5L2xpc3RGaWxlUmVjdXJzaXZlbHkuanMnXG5jb25zdCBtb2NoYU1vZHVsZSA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi9lbnRyeXBvaW50L2NsaS9pbmRleC5qcycpIC8vIG1vY2hhIGNsaSBmb3IgcnVubmluZyB1c2luZyBub2RlanMgc3Bhd24gY2hpbGQgcHJvY2VzcyBpbnRlcmZhY2UgKGFjY2VwdGluZyBvbmx5IG1vZHVsZSBwYXRocylcbmltcG9ydCB7IHdhdGNoRmlsZSB9IGZyb20gJ0BkZXBlbmRlbmN5L25vZGVqc0xpdmVSZWxvYWQnXG5pbXBvcnQgeyBwcm9taXNlcyBhcyBmaWxlc3lzdGVtIH0gZnJvbSAnZnMnXG5pbXBvcnQgY2hpbGRQcm9jZXNzIGZyb20gJ2NoaWxkX3Byb2Nlc3MnXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBydW5UZXN0KHtcbiAgdGFyZ2V0UHJvamVjdCwgLy8gYFByb2plY3QgY2xhc3NgIGluc3RhbmNlIGNyZWF0ZWQgYnkgYHNjcmlwdE1hbmFnZXJgIGZyb20gdGhlIGNvbmZpZ3VyYXRpb24gZmlsZSBvZiB0aGUgdGFyZ2V0IHByb2plY3QuXG4gIHRlc3RQYXRoLCAvLyByZWxhdGl2ZSBvciBhYnNvbHV0ZVxuICBqc0ZpbGVFeHRlbnNpb24gPSBbJy5qcycsICcudHMnXSxcbiAgdGVzdEZpbGVFeHRlbnNpb24gPSBbJy50ZXN0LmpzJ10sXG59ID0ge30pIHtcbiAgY29uc29sZS5sb2coYFxceDFiWzMzbVxceDFiWzFtXFx4MWJbN21cXHgxYlszNm0lc1xceDFiWzBtIFxceDFiWzJtXFx4MWJbM20lc1xceDFiWzBtYCwgYENvbnRhaW5lcjpgLCBgTm9kZUpTIEFwcGApXG5cbiAgLy8gU2V0dXAgZW52aXJvbm1lbnRcbiAgYXdhaXQgcmVxdWlyZSgnQGRlcGVuZGVuY3kvYWRkTW9kdWxlUmVzb2x1dGlvblBhdGgnKS5hZGRNb2R1bGVSZXNvbHV0aW9uUGF0aCh7IHBhdGhBcnJheTogW3BhdGguZGlybmFtZShyZXF1aXJlLm1haW4uZmlsZW5hbWUpXSB9KVxuXG4gIHByb2Nlc3Mub24oJ1NJR0lOVCcsICgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnQ2F1Z2h0IGludGVycnVwdCBzaWduYWwgLSB0ZXN0IGNvbnRhaW5lciBsZXZlbCcpXG4gICAgcHJvY2Vzcy5leGl0KDApXG4gIH0pXG5cbiAgYXNzZXJ0KHRhcmdldFByb2plY3QsIGB0YXJnZXRQcm9qZWN0IG11c3QgYmUgcGFzc2VkLmApXG4gIGxldCB0YXJnZXRQcm9qZWN0Um9vdFBhdGggPSB0YXJnZXRQcm9qZWN0LmNvbmZpZ3VyYXRpb24ucm9vdFBhdGhcblxuICBpZiAoIXBhdGguaXNBYnNvbHV0ZSh0ZXN0UGF0aCkpIHtcbiAgICB0ZXN0UGF0aCA9IHBhdGguam9pbih0YXJnZXRQcm9qZWN0Um9vdFBhdGgsIHRlc3RQYXRoKVxuICB9XG4gIGxldCBqc1BhdGhBcnJheSA9IFt0YXJnZXRQcm9qZWN0Um9vdFBhdGhdXG4gIGlmIChhd2FpdCBmaWxlc3lzdGVtLmxzdGF0KHRlc3RQYXRoKS50aGVuKHN0YXRPYmplY3QgPT4gc3RhdE9iamVjdC5pc0RpcmVjdG9yeSgpKSkganNQYXRoQXJyYXkucHVzaCh0ZXN0UGF0aClcblxuICAvKiBMaXN0IGFsbCBmaWxlcyBpbiBhIGRpcmVjdG9yeSByZWN1cnNpdmVseSAqL1xuICBjb25zb2xlLmxvZyhg4oCiIFNlYXJjaGluZyBmb3IgJHtKU09OLnN0cmluZ2lmeSh0ZXN0RmlsZUV4dGVuc2lvbil9IGV4dGVuc2lvbiBmaWxlcywgaW4gcGF0aCAke3Rlc3RQYXRofS5gKVxuICBsZXQgdGVzdEZpbGVBcnJheVxuICBpZiAodGVzdEZpbGVFeHRlbnNpb24uc29tZShleHRlbnNpb24gPT4gdGVzdFBhdGguZW5kc1dpdGgoZXh0ZW5zaW9uKSkpIHtcbiAgICAvLyBmaWxlIHBhdGhcbiAgICBjb25zb2xlLmxvZyh0ZXN0UGF0aClcbiAgICB0ZXN0RmlsZUFycmF5ID0gW3Rlc3RQYXRoXVxuICB9IGVsc2Uge1xuICAgIC8vIGRpcmVjdG9yeSBwYXRoXG4gICAgdGVzdEZpbGVBcnJheSA9IGxpc3RGaWxlV2l0aEV4dGVuc2lvbih7IGRpcmVjdG9yeTogdGVzdFBhdGgsIGV4dGVuc2lvbjogdGVzdEZpbGVFeHRlbnNpb24gfSlcbiAgfVxuXG4gIGxldCBqc0ZpbGVBcnJheU9mQXJyYXkgPSBqc1BhdGhBcnJheS5tYXAoanNQYXRoID0+IHtcbiAgICByZXR1cm4gbGlzdEZpbGVXaXRoRXh0ZW5zaW9uKHsgZGlyZWN0b3J5OiBqc1BhdGgsIGV4dGVuc2lvbjoganNGaWxlRXh0ZW5zaW9uIH0pXG4gIH0pXG4gIC8vVE9ETzogTXVzdCBhZGQgZXhjbHVkaW5nIGRpcmVjdG9yeSBvcHRpb24uIGUuZy4gJy4vZGlzdHJpYnV0aW9uJy5cbiAgLy8gYWRkIG5vZGVfbW9kdWxlcyBqcyBmaWxlc1xuICBsZXQgd2F0Y2hGaWxlQXJyYXkgPSBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBqc0ZpbGVBcnJheU9mQXJyYXkpXG5cbiAgbGV0IHN0cmluZ2lmeUFyZ3MgPSBKU09OLnN0cmluZ2lmeShbeyB0ZXN0VGFyZ2V0OiB0ZXN0RmlsZUFycmF5LCBqc0ZpbGVBcnJheToganNGaWxlQXJyYXlPZkFycmF5IH1dKSAvLyBwYXJhbWV0cnMgZm9yIG1vY2hhIG1vZHVsZS5cbiAgbGV0IHN1YnByb2Nlc3MgLy8gc3VicHJvY2VzcyByZWZlcmVuY2UgdG8gY29udHJvbCB0ZXJtaW5hdGlvbi5cbiAgZnVuY3Rpb24gcnVuTW9jaGFJblN1YnByb2Nlc3MoKSB7XG4gICAgLy8gcnVubmluZyBpbiBzdWJwcm9jZXNzIHByZXZlbnRzIGNvbmZsaWN0cyBiZXR3ZWVuIHRlc3RzIGFuZCBhbGxvd3MgdG8gY29udHJvbCB0aGUgdGVzdCBhbmQgdGVybWluYXRlIGl0IHdoZW4gbmVlZGVkLlxuICAgIHN1YnByb2Nlc3MgPSBjaGlsZFByb2Nlc3MuZm9yayhtb2NoYU1vZHVsZSwgW3N0cmluZ2lmeUFyZ3NdLCB7IHN0ZGlvOiBbMCwgMSwgMiwgJ2lwYyddIH0pXG4gICAgLy8gc3VicHJvY2Vzcy5vbignZXhpdCcsICgpID0+IGNvbnNvbGUubG9nKGBUZXN0IHN1YnByb2Nlc3MgJHtzdWJwcm9jZXNzLnBpZH0gZXhpdGVkLmApKTtcbiAgfVxuICBsZXQgdHJpZ2dlckNhbGxiYWNrID0gKCkgPT4ge1xuICAgIC8vIHRvIGJlIHJ1biBhZnRlciBmaWxlIG5vdGlmaWNhdGlvblxuICAgIHN1YnByb2Nlc3MgJiYgc3VicHJvY2Vzcy5raWxsKCdTSUdJTlQnKVxuICAgIHJ1bk1vY2hhSW5TdWJwcm9jZXNzKClcbiAgfVxuXG4gIGF3YWl0IHdhdGNoRmlsZSh7IHRyaWdnZXJDYWxsYmFjaywgZmlsZUFycmF5OiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBbd2F0Y2hGaWxlQXJyYXksIHRlc3RGaWxlQXJyYXldKSwgaWdub3JlTm9kZU1vZHVsZXM6IHRydWUsIGxvZ01lc3NhZ2U6IGZhbHNlIH0pXG5cbiAgcnVuTW9jaGFJblN1YnByb2Nlc3MoKSAvLyBpbml0aWFsIHRyaWdnZXIgYWN0aW9uLCB0byBydW4gdGVzdCBpbW1lZGlhdGVseVxufVxuXG4vKipcbiAqIEFsbG93cyB0byB1c2UgTm9kZWpzIGluc3BlY3RvciB3aXRoIHRoZSBjdXJyZW50IHdheSB0ZXN0cyBhcmUgcnVuLCB3aGVyZSB0ZXN0cyBhcmUgcnVuIGluIHN1YnByb2Nlc3NlcyBhbmQgbm8gTm9kZWpzIGZsYWdzIGFyZSBwYXNzZWQuXG4gKiBDdXJyZW50bHkgaXRzIHBvc3NpYmxlIHRvIHVzZSBpbnNwZWN0b3IgcHJvZ3JhbW1hdGljIEFQSSwgYnV0IHRvIGFsbG93IGxpdmVyZWxvYWQgZWFjaCB0ZXN0IHN1YnByb2Nlc3Mgc2hvdWxkIGJlIGtlcHQgYWxpdmUgZS5nLiB1c2luZyBgc2V0VGltZW91dGAgdG8gYWxsb3cgZm9yIGluc3BlY3Rpbmcgb2JqZWN0IHZhbHVlcyBldGMuXG4gKiBVc2FnZTpcbiAqICAtIGV4ZWN1dGUgdGhpcyBmdW5jdGlvbiBpbiB0aGUgdG9wIG9mIGEgdGVzdC5cbiAqICAtIGluc2VydCBgZGVidWdnZXJgIHN0YXRlbWVudCBpbiB0aGUgdGVzdCBmaWxlcyB0byBicmVhayBhZnRlciByZWZyZXNoaW5nIHByb2Nlc3MuXG4gKlxuICovXG5leHBvcnQgZnVuY3Rpb24gc3VicHJvY2Vzc0luc3BlY3Rvcih7IHBvcnQgPSA5MjI5LCBob3N0ID0gJ2xvY2FsaG9zdCcsIHNob3VsZGJyZWFrID0gdHJ1ZSB9ID0ge30pIHtcbiAgY29uc3QgaW5zcGVjdG9yID0gcmVxdWlyZSgnaW5zcGVjdG9yJylcbiAgaW5zcGVjdG9yLm9wZW4ocG9ydCwgaG9zdCwgc2hvdWxkYnJlYWspXG4gIC8vIEtlZXAgTm9kZSBhbGl2ZSB0byBhbGxvdyBmb3IgaW5zcGVjdGluZyBvYmplY3RzLlxuICBwcm9jZXNzLm9uKCdiZWZvcmVFeGl0JywgKCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge30sIDEwMDAwMDAwMDApXG4gIH0pXG4gIHJldHVybiBpbnNwZWN0b3Jcbn1cbiJdfQ==